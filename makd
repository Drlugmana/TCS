// GET: api/Problems/by-range
[HttpGet("by-range")]
public async Task<ActionResult<PagedResponse<ProblemDynatraceResponse>>> GetProblemsByRange(
    DateTime? startDate = null,
    DateTime? endDate = null,
    int pageNumber = 1,
    int pageSize = 50)
{
    // Default: ayer 00:00 hasta ahora
    var from = startDate ?? DateTime.Today.AddDays(-1);
    var to = endDate ?? DateTime.Now;

    var baseQuery = _context.DynatraceProblems
        .AsNoTracking()
        .Where(p => p.StartTime >= from && p.StartTime < to);

    var totalRecords = await baseQuery.CountAsync();

    var problems = await baseQuery
        .OrderByDescending(p => p.StartTime)
        .Skip((pageNumber - 1) * pageSize)
        .Take(pageSize)
        .ToListAsync();

    // MISMA lÃ³gica que tu GetProblems (misma estructura)
    var deserializedProblems = problems
        .Select(problem =>
        {
            try
            {
                return convertProblemJSON(problem);
            }
            catch
            {
                return null;
            }
        })
        .Where(p => p != null)
        .ToList();

    return new PagedResponse<ProblemDynatraceResponse>
    {
        TotalRecords = totalRecords,
        TotalPages = (int)Math.Ceiling(totalRecords / (double)pageSize),
        PageNumber = pageNumber,
        PageSize = pageSize,
        Data = deserializedProblems
    };
}