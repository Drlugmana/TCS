
var builder = WebApplication.CreateBuilder(args);

// Permitir que se ejecute como servicio en Windows
builder.Host.UseWindowsService();

// Configurar servicios
builder.Services.AddControllers();
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

var app = builder.Build();

// ✅ Siempre habilitar Swagger
app.UseSwagger();
app.UseSwaggerUI();

// ⚠️ Evitar redirección a HTTPS si no usas certificado
// app.UseHttpsRedirection();  // <--- comenta o elimina esta línea

app.UseAuthorization();
app.MapControllers();
app.MapGet("/", () => Results.Ok("API RestAPIDynatraceReportes funcionando correctamente"));
app.Run();

D:\software\RestAPIDynatraceReportes\RestAPIDynatraceReportes\



cd "D:\software\RestAPIDynatraceReportes\RestAPIDynatraceReportes"
dir *.exe
.\RestAPIDynatraceReportes.exe

setx ASPNETCORE_ENVIRONMENT "Production" /M
setx ASPNETCORE_URLS "http://0.0.0.0:5000" /M


$svc = "RestAPIDynatraceReportes"
$exe = "D:\software\RestAPIDynatraceReportes\RestAPIDynatraceReportes\RestAPIDynatraceReportes.exe"

sc.exe create $svc binPath= "$exe" start= auto
sc.exe description $svc "API Dynatrace Reportes - Kestrel self-contained"
sc.exe start $svc
sc.exe query $svc


sc.exe failure $svc reset= 86400 actions= restart/60000/restart/60000/restart/60000
sc.exe failureflag $svc 1

netsh advfirewall firewall add rule name="API Dynatrace Reportes 5000" dir=in action=allow protocol=TCP localport=5000

http://10.70.72.120:5000/swagger


$svc = "RestAPIDynatraceReportes"
sc stop  $svc
# Copia/pega los nuevos archivos sobre: D:\software\RestAPIDynatraceReportes\RestAPIDynatraceReportes\
sc start $svc

{
  "EnableSwagger": true,
  "Kestrel": {
    "Endpoints": {
      "Http": { "Url": "http://0.0.0.0:5000" }
    }
  },
  "AllowedHosts": "*"
}
