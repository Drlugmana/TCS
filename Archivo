foreach (var kvp in entitiesList)
{
    // CON dominio (FQDN) tal cual
    var fullKey = (kvp.Key ?? string.Empty).Trim().ToUpperInvariant();
    if (!string.IsNullOrEmpty(fullKey))
        normalizedEntities.TryAdd(fullKey, kvp.Value);

    // SIN dominio (primer label) para hacer match flexible
    var shortKey = fullKey.Split('.')[0];
    if (!string.IsNullOrEmpty(shortKey))
        normalizedEntities.TryAdd(shortKey, kvp.Value);
}

// Tomar el nombre tal cual Dynatrace (FQDN si existe)
string dynNameFull =
    latest?.Properties?.OneAgentCustomHostName ??
    latest?.Properties?.DetectedName ??
    latest?.DisplayName ??
    server?.Name; // fallback por si acaso

worksheet.Cells[row, 1].Value = dynNameFull;   // ahora sale igual que en Dynatrace